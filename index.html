<script>
// ===== RÉCUPÉRER L'EMAIL DEPUIS L'URL =====
const urlParams = new URLSearchParams(window.location.search);
const emailFromUrl = urlParams.get('email');

const emailInput = document.getElementById('email');

if (emailFromUrl) {
    // Décoder et pré-remplir l'email
    emailInput.value = decodeURIComponent(emailFromUrl);
} else {
    // Pas d'email dans l'URL - afficher un avertissement
    emailInput.style.backgroundColor = '#ffe6e6';
    emailInput.placeholder = '⚠️ Ce formulaire doit être ouvert via le lien reçu par email';
}

// ===== GESTION DE "RIEN À SIGNALER" =====
const nothingToReportCheckbox = document.getElementById('nothingToReport');
const startDateInput = document.getElementById('startDate');
const endDateInput = document.getElementById('endDate');
const commentsInput = document.getElementById('comments');

nothingToReportCheckbox.addEventListener('change', function() {
    if (this.checked) {
        // Désactiver UNIQUEMENT les dates et commentaires
        startDateInput.disabled = true;
        startDateInput.required = false;
        startDateInput.value = '';
        startDateInput.style.backgroundColor = '#f5f5f5';
        
        endDateInput.disabled = true;
        endDateInput.required = false;
        endDateInput.value = '';
        endDateInput.style.backgroundColor = '#f5f5f5';
        
        commentsInput.disabled = true;
        commentsInput.value = '';
        commentsInput.style.backgroundColor = '#f5f5f5';
        
        // ⚠️ IMPORTANT : NE PAS TOUCHER À L'EMAIL
        // L'email reste visible, pré-rempli et en readonly
        
    } else {
        // Réactiver les dates et commentaires
        startDateInput.disabled = false;
        startDateInput.required = true;
        startDateInput.style.backgroundColor = 'white';
        
        endDateInput.disabled = false;
        endDateInput.required = true;
        endDateInput.style.backgroundColor = 'white';
        
        commentsInput.disabled = false;
        commentsInput.style.backgroundColor = 'white';
    }
});

// ===== VALIDATION AVANT ENVOI =====
document.getElementById('stopSalesForm').addEventListener('submit', function(e) {
    const hotelName = document.getElementById('hotelName').value.trim();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const nothingToReport = document.getElementById('nothingToReport').checked;
    
    // Vérifier les champs obligatoires
    if (!hotelName) {
        e.preventDefault();
        alert('⚠️ Le nom de l\'hôtel est obligatoire, même si vous n\'avez rien à signaler.');
        document.getElementById('hotelName').focus();
        return false;
    }
    
    if (!name) {
        e.preventDefault();
        alert('⚠️ Votre nom complet est obligatoire.');
        document.getElementById('name').focus();
        return false;
    }
    
    if (!email) {
        e.preventDefault();
        alert('⚠️ L\'email est obligatoire.');
        document.getElementById('email').focus();
        return false;
    }
    
    // Si "Rien à signaler" n'est PAS coché, vérifier les dates
    if (!nothingToReport) {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        if (!startDate || !endDate) {
            e.preventDefault();
            alert('⚠️ Les dates sont obligatoires si vous avez un stop sales à signaler.');
            return false;
        }
        
        if (new Date(startDate) > new Date(endDate)) {
            e.preventDefault();
            alert('⚠️ La date de début doit être antérieure à la date de fin.');
            return false;
        }
    }
    
    return true;
});
</script>
